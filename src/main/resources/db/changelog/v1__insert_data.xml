<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
            http://www.liquibase.org/xml/ns/dbchangelog
            http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="01-insert-roles" author="alan">
        <insert tableName="roles">
            <column name="role_name" value="USER"/>
        </insert>
        <insert tableName="roles">
            <column name="role_name" value="REVIEWER"/>
        </insert>
        <insert tableName="roles">
            <column name="role_name" value="ADMIN"/>
        </insert>
        <insert tableName="roles">
            <column name="role_name" value="MENTOR"/>
        </insert>
    </changeSet>

    <changeSet id="02-insert-permissions" author="alan">
        <insert tableName="permissions">
            <column name="permission_name" value="VIEW"/>
        </insert>
        <insert tableName="permissions">
            <column name="permission_name" value="CREATE"/>
        </insert>
        <insert tableName="permissions">
            <column name="permission_name" value="UPDATE"/>
        </insert>
        <insert tableName="permissions">
            <column name="permission_name" value="ACCEPT"/>
        </insert>
        <insert tableName="permissions">
            <column name="permission_name" value="REMOVE"/>
        </insert>
        <insert tableName="permissions">
            <column name="permission_name" value="REPLY"/>
        </insert>
    </changeSet>

    <changeSet id="03-insert-role-permissions" author="alan">

        <!-- Role -->
        <insert tableName="roles_permissions">
            <column name="role_id"
                    valueComputed="(SELECT id FROM roles WHERE role_name = 'USER')"/>
            <column name="permission_id"
                    valueComputed="(SELECT id FROM permissions WHERE permission_name = 'VIEW')"/>
        </insert>

        <insert tableName="roles_permissions">
            <column name="role_id"
                    valueComputed="(SELECT id FROM roles WHERE role_name = 'USER')"/>
            <column name="permission_id"
                    valueComputed="(SELECT id FROM permissions WHERE permission_name = 'CREATE')"/>
        </insert>

        <insert tableName="roles_permissions">
            <column name="role_id"
                    valueComputed="(SELECT id FROM roles WHERE role_name = 'USER')"/>
            <column name="permission_id"
                    valueComputed="(SELECT id FROM permissions WHERE permission_name = 'UPDATE')"/>
        </insert>

        <!-- REVIEWER -->
        <insert tableName="roles_permissions">
            <column name="role_id"
                    valueComputed="(SELECT id FROM roles WHERE role_name = 'REVIEWER')"/>
            <column name="permission_id"
                    valueComputed="(SELECT id FROM permissions WHERE permission_name = 'VIEW')"/>
        </insert>

        <insert tableName="roles_permissions">
            <column name="role_id"
                    valueComputed="(SELECT id FROM roles WHERE role_name = 'REVIEWER')"/>
            <column name="permission_id"
                    valueComputed="(SELECT id FROM permissions WHERE permission_name = 'ACCEPT')"/>
        </insert>

        <!-- MENTOR -->
        <insert tableName="roles_permissions">
            <column name="role_id"
                    valueComputed="(SELECT id FROM roles WHERE role_name = 'MENTOR')"/>
            <column name="permission_id"
                    valueComputed="(SELECT id FROM permissions WHERE permission_name = 'VIEW')"/>
        </insert>

        <insert tableName="roles_permissions">
            <column name="role_id"
                    valueComputed="(SELECT id FROM roles WHERE role_name = 'MENTOR')"/>
            <column name="permission_id"
                    valueComputed="(SELECT id FROM permissions WHERE permission_name = 'REPLY')"/>
        </insert>

        <insert tableName="roles_permissions">
            <column name="role_id"
                    valueComputed="(SELECT id FROM roles WHERE role_name = 'MENTOR')"/>
            <column name="permission_id"
                    valueComputed="(SELECT id FROM permissions WHERE permission_name = 'ACCEPT')"/>
        </insert>

        <!-- ADMIN (ALL EXCEPT REPLY) -->
        <insert tableName="roles_permissions">
            <column name="role_id"
                    valueComputed="(SELECT id FROM roles WHERE role_name = 'ADMIN')"/>
            <column name="permission_id"
                    valueComputed="(SELECT id FROM permissions WHERE permission_name = 'VIEW')"/>
        </insert>

        <insert tableName="roles_permissions">
            <column name="role_id"
                    valueComputed="(SELECT id FROM roles WHERE role_name = 'ADMIN')"/>
            <column name="permission_id"
                    valueComputed="(SELECT id FROM permissions WHERE permission_name = 'CREATE')"/>
        </insert>

        <insert tableName="roles_permissions">
            <column name="role_id"
                    valueComputed="(SELECT id FROM roles WHERE role_name = 'ADMIN')"/>
            <column name="permission_id"
                    valueComputed="(SELECT id FROM permissions WHERE permission_name = 'UPDATE')"/>
        </insert>

        <insert tableName="roles_permissions">
            <column name="role_id"
                    valueComputed="(SELECT id FROM roles WHERE role_name = 'ADMIN')"/>
            <column name="permission_id"
                    valueComputed="(SELECT id FROM permissions WHERE permission_name = 'ACCEPT')"/>
        </insert>

        <insert tableName="roles_permissions">
            <column name="role_id"
                    valueComputed="(SELECT id FROM roles WHERE role_name = 'ADMIN')"/>
            <column name="permission_id"
                    valueComputed="(SELECT id FROM permissions WHERE permission_name = 'REMOVE')"/>
        </insert>

    </changeSet>
</databaseChangeLog>
